<!DOCTYPE html>
<html lang="fr" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>MSE ONE | Neon Elite Suite</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        /* --- DYNAMIC ONE UI 8 NEON THEME --- */
        :root {
            --bg: #000000; 
            --surface: #050505; 
            --panel: rgba(20, 20, 20, 0.7);
            --card: #0D0D0E; 
            --border: rgba(255, 255, 255, 0.05);
            --red-mse: #FF3B30;
            --gold-neon: #C5A059;
            --blue-neon: #007AFF;
            --green-neon: #32D74B;
            --purple-neon: #BF5AF2;
            --text: #FFFFFF;
            --text-dim: #8E8E93;
            --radius-os: 34px;
        }

        [data-theme="light"] {
            --bg: #F2F2F7;
            --surface: #FFFFFF;
            --panel: rgba(242, 242, 247, 0.8);
            --card: #FFFFFF;
            --border: rgba(0, 0, 0, 0.05);
            --text: #000000;
            --text-dim: #666666;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; font-family: 'Inter', system-ui, sans-serif; transition: all 0.4s cubic-bezier(0.2, 0, 0, 1); }
        body { margin: 0; background: var(--bg); color: var(--text); height: 100vh; overflow: hidden; }

        header { padding: calc(env(safe-area-inset-top) + 30px) 24px 20px; }
        .header-top { display: flex; justify-content: space-between; align-items: center; width: 100%; }
        .brand { font-size: 28px; font-weight: 800; letter-spacing: -1.5px; }
        .brand span { color: var(--red-mse); text-shadow: 0 0 15px rgba(255, 59, 48, 0.4); }
        .theme-btn { width: 50px; height: 50px; border-radius: 50%; background: var(--panel); border: 1px solid var(--border); display: flex; align-items: center; justify-content: center; font-size: 22px; cursor: pointer; box-shadow: 0 0 15px rgba(255,255,255,0.05); }

        /* --- NEON BENTO GRID --- */
        #hub { height: 100%; overflow-y: auto; padding: 0 20px 180px; }
        .bento-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 18px; }
        .section-label { grid-column: span 2; font-size: 13px; font-weight: 800; color: var(--text-dim); text-transform: uppercase; letter-spacing: 2px; margin: 35px 0 12px 10px; }

        .app-card {
            background: var(--card); border-radius: var(--radius-os); padding: 25px;
            border: 1px solid var(--border); display: flex; flex-direction: column;
            align-items: center; justify-content: center; text-align: center;
            min-height: 160px; position: relative; overflow: hidden;
        }
        .app-card img { width: 64px; height: 64px; object-fit: contain; margin-bottom: 12px; filter: drop-shadow(0 0 10px var(--neon-color)); }
        .app-card b { font-size: 14px; font-weight: 700; color: var(--text); z-index: 2; }
        .app-card:active { transform: scale(0.92); box-shadow: 0 0 30px var(--neon-color); border-color: var(--neon-color); }

        /* Neon Categories */
        .neon-premium { --neon-color: rgba(197, 160, 89, 0.5); }
        .neon-micro { --neon-color: rgba(0, 122, 255, 0.5); }
        .neon-success { --neon-color: rgba(50, 215, 75, 0.5); }
        .neon-finance { --neon-color: rgba(191, 90, 242, 0.5); }
        .neon-alert { --neon-color: rgba(255, 59, 48, 0.5); }

        .full { grid-column: span 2; }

        /* --- SYSTEM SHEET --- */
        .window { position: fixed; inset: 0; background: var(--bg); z-index: 1000; display: none; flex-direction: column; animation: slideUp 0.5s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        .win-header { padding: calc(env(safe-area-inset-top) + 20px) 24px 15px; display: flex; align-items: center; justify-content: space-between; }
        .win-body { flex: 1; overflow-y: auto; padding: 20px 20px 180px; }
        
        .pro-card { background: var(--card); border-radius: var(--radius-os); padding: 25px; margin-bottom: 18px; border: 1px solid var(--border); box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .pro-card h4 { margin: 0 0 18px; font-size: 11px; color: var(--gold-neon); text-transform: uppercase; letter-spacing: 2.5px; font-weight: 800; }
        
        input, textarea, select { width: 100%; background: var(--panel); border: 1.5px solid transparent; border-radius: 22px; padding: 20px; color: var(--text); font-size: 16px; font-weight: 500; margin-bottom: 12px; outline: none; }
        input:focus { border-color: var(--neon-color); box-shadow: 0 0 15px var(--neon-color); }

        .line-item { border-bottom: 1px solid var(--border); padding-bottom: 20px; margin-bottom: 20px; }
        .l-title { font-weight: 900; font-size: 19px; background: transparent; border: none; border-bottom: 2px solid var(--border); border-radius: 0; padding-left: 0; }
        .l-desc { font-style: italic; font-size: 14px; opacity: 0.6; font-weight: 300; border: none; padding-left: 0; }

        /* --- GLOWING DOCK --- */
        .dock { position: fixed; bottom: 30px; left: 20px; right: 20px; background: rgba(10, 10, 10, 0.85); backdrop-filter: blur(45px); -webkit-backdrop-filter: blur(45px); border: 1.5px solid var(--border); border-radius: 45px; padding: 20px 30px; display: flex; justify-content: space-between; align-items: center; z-index: 1100; box-shadow: 0 20px 60px rgba(0,0,0,0.5); }
        .btn-mse { background: var(--red-mse); color: #fff; border: none; padding: 22px 50px; border-radius: 28px; font-weight: 900; font-size: 15px; cursor: pointer; box-shadow: 0 15px 30px rgba(255, 59, 48, 0.4); }

        /* --- PDF UHD PREVIEW --- */
        #preview-overlay { display: none; position: fixed; inset: 0; background: #000; z-index: 2000; flex-direction: column; }
        #pdf-paper { background: white !important; color: black !important; width: 100%; min-height: 100%; }
        .stamp { border: 6px solid var(--red-mse); color: var(--red-mse); padding: 12px 24px; font-size: 28px; font-weight: 900; position: absolute; top: 180px; right: 40px; transform: rotate(-12deg); text-transform: uppercase; border-radius: 15px; opacity: 0.8; }
    </style>
</head>
<body>

<header>
    <div class="header-top">
        <div class="brand">MSE <span>ONE</span></div>
        <div class="theme-btn" onclick="toggleTheme()" id="t-btn">üåô</div>
    </div>
</header>

<div id="hub">
    <div class="bento-grid">
        <div class="section-label">Solutions Premium</div>
        <div class="app-card neon-premium" onclick="openApp('DEVIS', 'standard')"><img src="devis.png"><b>Devis Premium</b></div>
        <div class="app-card neon-premium" onclick="openApp('FACTURE', 'standard')"><img src="facture.png"><b>Facture Premium</b></div>
        <div class="app-card full neon-success" onclick="openApp('FACTURE ACQUITT√âE', 'standard')"><img src="acquittee.png"><b>Facture Acquitt√©e</b></div>

        <div class="section-label">R√©gime Micro</div>
        <div class="app-card neon-micro" onclick="openApp('DEVIS', 'micro')"><img src="devis.png"><b>Devis Micro</b></div>
        <div class="app-card neon-micro" onclick="openApp('FACTURE', 'micro')"><img src="facture.png"><b>Facture Micro</b></div>

        <div class="section-label">Finance & Performance</div>
        <div class="app-card neon-finance" onclick="alert('Module Clients')"><img src="clients.png"><b>Clients</b></div>
        <div class="app-card neon-finance" onclick="alert('Module Valid√©s')"><img src="rendement.png"><b>Valid√©s</b></div>
        <div class="app-card neon-alert" onclick="alert('Module URSSAF')"><img src="urssaf.png"><b>URSSAF</b></div>
        <div class="app-card neon-finance" onclick="alert('Module Net R√©el')"><img src="net.png"><b>Net R√©el</b></div>
    </div>
</div>

<div id="win" class="window">
    <div class="win-header">
        <div onclick="closeApp()" style="font-size: 38px; cursor:pointer; font-weight: 200;">‚úï</div>
        <h2 style="font-size: 18px; font-weight: 800; letter-spacing: 1px;">EDITION PRO</h2>
        <div style="width: 38px;"></div>
    </div>
    <div class="win-body" id="win-content"></div>
    <div class="dock" id="win-dock" style="display:none;">
        <div><div style="font-size:10px; font-weight:900; color:var(--text-dim); text-transform:uppercase; letter-spacing:1px;">Net √† Payer</div><div id="dock-total" style="font-size:26px; font-weight:900;">0.00 ‚Ç¨</div></div>
        <button class="btn-mse" onclick="generatePreview()">EXPORTER PDF</button>
    </div>
</div>

<div id="preview-overlay">
    <div style="padding: 60px 20px 20px; display:flex; gap:12px; background:rgba(0,0,0,0.9);"><button class="btn-mse" style="flex:1; background:#222; box-shadow:none;" onclick="document.getElementById('preview-overlay').style.display='none'">RETOUR</button><button class="btn-mse" style="flex:2;" onclick="downloadPDF()">TELECHARGER UHD</button></div>
    <div style="flex:1; overflow-y:auto; padding:15px; background:#111;"><div id="pdf-paper"></div></div>
</div>

<script>
let curMode = "standard"; let curType = "FACTURE";
const USER = { name: "Sabri BENNACEUR EI", addr: "2 R√©sidence des Rosiers, 92800 Puteaux, FR", email: "serruremse@gmail.com", siren: "943032755", iban: "FR76 1695 8000 0159 6810 0824 765", bic: "ONTO FR P1 XXX" };

function toggleTheme(){ document.documentElement.setAttribute('data-theme', document.documentElement.getAttribute('data-theme') === 'dark' ? 'light' : 'dark'); }

function openApp(type, mode='standard'){
    curType = type; curMode = mode;
    document.getElementById('win').style.display = 'flex';
    document.getElementById('win-dock').style.display = 'flex';
    renderEditor(document.getElementById('win-content'));
}

function closeApp(){ document.getElementById('win').style.display = 'none'; }

function renderEditor(c){
    c.innerHTML = `
        <div class="pro-card"><h4>üìÇ Dossier Pro</h4><input type="text" id="doc-num" placeholder="Num√©ro Document"><input type="text" id="doc-obj" placeholder="Objet de l'intervention"></div>
        <div class="pro-card"><h4>üë§ Client</h4><input type="text" id="c-name" placeholder="Nom complet"><textarea id="c-addr" placeholder="Adresse compl√®te" rows="2"></textarea>
        <div style="display:flex; align-items:center; gap:12px;"><input type="checkbox" id="ref-check" style="width:24px;height:24px;" onchange="document.getElementById('c-ref').style.display = this.checked ? 'block' : 'none'"><span style="font-size:14px; font-weight:600;">R√©f√©rence Client ?</span></div>
        <input type="text" id="c-ref" placeholder="N¬∞ Dossier / Syndic" style="display:none; margin-top:15px;"></div>
        ${curMode==='standard' ? `<div class="pro-card"><h4>‚öôÔ∏è Taxes</h4><select id="tva-rate" onchange="updateCalc()"><option value="20">Standard 20%</option><option value="10">R√©duit 10%</option><option value="5.5">Energie 5.5%</option></select></div>` : ''}
        <div class="pro-card"><h4>üõ†Ô∏è Prestations</h4><div id="lines"></div><button onclick="addLine()" style="background:none; border:1.5px dashed var(--border); color:var(--text); padding:22px; width:100%; border-radius:28px; font-weight:700;">+ AJOUTER LIGNE</button></div>`;
    addLine();
}

function addLine(){
    const id = Date.now();
    const div = document.createElement('div'); div.className = 'line-item'; div.id = 'l-'+id;
    div.innerHTML = `<input type="text" class="l-t" placeholder="Titre (Extra-Bold)" style="font-weight:900;"><textarea class="l-d" placeholder="D√©tails techniques (Italique)" rows="1" style="font-style:italic; font-weight:300; opacity:0.7; border:none;"></textarea>
    <div style="display:flex; gap:10px; margin-top:12px;"><input type="number" class="l-q" value="1" style="flex:1" oninput="updateCalc()"><input type="number" class="l-p" placeholder="Prix" style="flex:2" oninput="updateCalc()" inputmode="decimal">
    <button onclick="document.getElementById('l-${id}').remove(); updateCalc();" style="background:none; border:none; color:var(--red-mse); font-size:26px;">‚úï</button></div>`;
    document.getElementById('lines').appendChild(div);
}

function updateCalc(){
    let raw = 0;
    document.querySelectorAll('.line-item').forEach(l => { raw += (l.querySelector('.l-q').value * l.querySelector('.l-p').value); });
    const rate = curMode === 'standard' ? parseFloat(document.getElementById('tva-rate')?.value || 20) : 0;
    const final = raw * (1 + rate/100);
    document.getElementById('dock-total').innerText = final.toFixed(2) + ' ‚Ç¨';
    return { raw, final, rate };
}

function generatePreview(){
    const data = updateCalc();
    const isPremium = (curMode === 'standard');
    const isQuote = (curType === 'DEVIS');
    const date = new Date().toLocaleDateString('fr-FR');
    let rows = "";
    document.querySelectorAll('.line-item').forEach(l => {
        const t = l.querySelector('.l-t').value;
        const d = l.querySelector('.l-d').value;
        const q = l.querySelector('.l-q').value;
        const p = parseFloat(l.querySelector('.l-p').value || 0);
        rows += `<tr><td style="padding:15px 10px; border-bottom:1px solid #eee; vertical-align:top;"><div style="font-weight:900; font-size:14px; color:#000;">${t}</div><div style="font-style:italic; font-size:10px; color:#555; font-weight:300;">${d}</div></td><td style="text-align:center;">${q}</td><td style="text-align:right;">${p.toFixed(2)} ‚Ç¨</td><td style="text-align:right;">${(q*p).toFixed(2)} ‚Ç¨</td>${isPremium ? `<td style="text-align:center;">${data.rate}%</td><td style="text-align:right;">${(q*p*(data.rate/100)).toFixed(2)} ‚Ç¨</td>` : ''}</tr>`;
    });

    document.getElementById('pdf-paper').innerHTML = `
    <div style="padding:45px; position:relative; color:#000; background:#fff; font-family:Arial, sans-serif;">
        ${curType.includes('ACQUITT√âE') ? `<div class="stamp">ACQUITT√âE</div>` : ''}
        <div style="display:flex; justify-content:space-between; border-bottom:2px solid #eee; padding-bottom:30px;">
            <div style="width:55%;"><img src="logo.png" style="max-width:250px; max-height:110px;" onerror="this.style.display='none'">
            <div style="font-size:13px; color:#555; margin-top:15px;"><strong>${USER.name}</strong><br>${USER.addr}<br>${USER.email}</div></div>
            <div style="background:#f8f8f8; padding:20px; width:44%; border-left:5px solid #333;"><strong>${isQuote?'Devis pour :':'Facturer √† :'}</strong><br><br><strong>${document.getElementById('c-name').value}</strong><br>${document.getElementById('c-addr').value.replace(/\n/g,'<br>')}</div>
        </div>
        <div style="display:flex; justify-content:space-between; border-bottom:4px solid #D32F2F; margin: 30px 0 20px; padding-bottom:15px;">
            <div><h1 style="margin:0; font-size:26px;">${curType} N¬∞ ${document.getElementById('doc-num').value}</h1><div style="color:#D32F2F; font-weight:bold; margin-top:5px;">Objet : ${document.getElementById('doc-obj').value}</div>
            ${document.getElementById('ref-check').checked ? `<div style="font-size:11px; margin-top:5px;"><strong>R√©f :</strong> ${document.getElementById('c-ref').value}</div>` : ''}</div>
            <div style="text-align:right; font-size:12px;"><strong>Date :</strong> ${date}<br><strong>Ech√©ance :</strong> ${date}</div>
        </div>
        <table style="width:100%; border-collapse:collapse; font-size:12px;">
            <thead><tr style="background:#333; color:#fff;"><th style="text-align:left; padding:12px;">Prestation & D√©tails</th><th>Qt√©</th><th>P.U</th><th>Total</th>${isPremium?'<th>TVA</th><th>Mt TVA</th>':''}</tr></thead>
            <tbody>${rows}</tbody>
        </table>
        <div style="display:flex; justify-content:flex-end; margin-top:30px;">
            <table style="width:320px; text-align:right; font-size:15px;">
                <tr><td>Total ${isPremium?'HT':'NET'}</td><td>${data.raw.toFixed(2)} ‚Ç¨</td></tr>
                ${isPremium ? `<tr><td>Total TVA (${data.rate}%)</td><td>${(data.final - data.raw).toFixed(2)} ‚Ç¨</td></tr>` : ''}
                <tr style="font-size:22px; font-weight:900; color:#D32F2F; border-top:3px solid #000;"><td>${isPremium?'TOTAL TTC':'MONTANT NET'}</td><td>${data.final.toFixed(2)} ‚Ç¨</td></tr>
            </table>
        </div>
        <div style="margin-top:100px; border-top:1px solid #ddd; padding-top:25px; display:flex; justify-content:space-between; font-size:11px; color:#555;">
            <div style="width:60%;"><strong>RIB :</strong> ${USER.iban}<br>BIC : ${USER.bic}</div>
            <div style="text-align:right;">${isQuote?'Mention "Bon pour accord", Signature :':'Signature et cachet'}</div>
        </div>
        <div style="text-align:center; font-size:9px; color:#999; margin-top:40px;">SIRET ${USER.siren} - ${!isPremium ? 'TVA non applicable, art. 293 B du CGI.' : ''}</div>
    </div>`;
    document.getElementById('preview-overlay').style.display = 'flex';
}

function downloadPDF(){
    const el = document.getElementById('pdf-paper');
    // UHD Scale 3 (300 DPI) for perfect Fine Italic rendering [cite: 2026-01-02]
    html2pdf().set({ margin:0, filename:`MSE_${curType}.pdf`, html2canvas:{scale:3, useCORS:true}, jsPDF:{unit:'mm', format:'a4'} }).from(el).save();
}
</script>
</body>
</html>
